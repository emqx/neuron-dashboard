(window["webpackJsonp_eKuiper"]=window["webpackJsonp_eKuiper"]||[]).push([["chunk-218371dd"],{"06d9":function(t,e,r){"use strict";r("226c")},"226c":function(t,e,r){},"50fc":function(t,e,r){"use strict";r.d(e,"f",(function(){return i})),r.d(e,"b",(function(){return o})),r.d(e,"d",(function(){return s})),r.d(e,"j",(function(){return a})),r.d(e,"h",(function(){return c})),r.d(e,"e",(function(){return u})),r.d(e,"a",(function(){return l})),r.d(e,"c",(function(){return d})),r.d(e,"i",(function(){return p})),r.d(e,"g",(function(){return f}));var n=r("751a"),i=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n["a"].get("/users",{params:t})},o=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n["a"].post("/users",t)},s=function(t){return n["a"].delete("/users/".concat(t))},a=function(t){return n["a"].get("/users/".concat(t))},c=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return n["a"].put("/users/".concat(t),e)},u=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n["a"].get("/roles",{params:t})},l=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n["a"].post("/roles",t)},d=function(t){return n["a"].delete("/roles/".concat(t))},p=function(t){return n["a"].get("/roles/".concat(t))},f=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return n["a"].put("/roles/".concat(t),e)}},f7fb:function(t,e,r){"use strict";r.r(e);var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"role-details"},[r("div",{staticClass:"page-header"},[r("Breadcrumb",[r("BreadcrumbItem",{attrs:{to:"/roles"}},[t._v(t._s(this.$t("admin.roles")))]),r("BreadcrumbItem",[t._v(t._s(t.operTitle))])],1)],1),r("Card",{staticClass:"detail",attrs:{shadow:""}},[r("Form",{ref:"record",attrs:{model:t.record,rules:t.isDetail&&!t.isEdit?{}:t.rules}},[r("Row",[r("i-col",{attrs:{span:"16"}},[r("FormItem",{attrs:{label:t.$t("admin.roleName"),prop:"name"}},[r("i-input",{attrs:{size:"large",disabled:t.isDetail&&!t.isEdit},model:{value:t.record.name,callback:function(e){t.$set(t.record,"name",e)},expression:"record.name"}})],1)],1),r("i-col",{attrs:{span:"16"}},[r("FormItem",{attrs:{label:t.$t("common.description"),prop:"description"}},[r("i-input",{attrs:{size:"large",disabled:t.isDetail&&!t.isEdit,type:"textarea"},model:{value:t.record.description,callback:function(e){t.$set(t.record,"description",e)},expression:"record.description"}})],1)],1)],1)],1),t.loading?r("Spin",{attrs:{size:"large",fix:""}}):t._e()],1),r("div",{staticClass:"permission-title"},[t._v(t._s(t.$t("admin.permissionList")))]),r("Card",{staticClass:"permission-card",attrs:{shadow:""}},[r("Tabs",{attrs:{animated:!1},on:{"on-click":t.findCurrentPermission},model:{value:t.currentTab,callback:function(e){t.currentTab=e},expression:"currentTab"}},t._l(t.authTabs,(function(e){return r("TabPane",{key:e,attrs:{label:e,name:e}},[r("div",{staticClass:"tab-content"},[t.currentTab===e?r("Table",{attrs:{columns:t.permissionCol,data:t.currentPermission}}):t._e()],1)])})),1)],1),!t.isDetail||t.isEdit?r("Button",{attrs:{type:"primary"},on:{click:t.save}},[t._v(t._s(t.$t("common.submit")))]):t._e(),r("Button",{style:t.isDetail?"":"margin-left: 8px",attrs:{type:"text",to:"/roles"}},[t._v(" "+t._s(t.$t("common.cancel"))+" ")])],1)},i=[],o=r("3786"),s=r("50fc");function a(t){return d(t)||l(t)||u(t)||c()}function c(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function u(t,e){if(t){if("string"===typeof t)return p(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?p(t,e):void 0}}function l(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function d(t){if(Array.isArray(t))return p(t)}function p(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var f={name:"RoleDetails",data:function(){return{id:this.$route.params.id,loading:!1,allMethods:["POST","GET","PUT","DELETE"],permissionList:[],currentTab:"roles",rolePolicies:[],currentPermission:[],authTabs:[],permissionOption:[{value:"never",label:"never"},{value:0,label:"always"},{value:1,label:"owned"}],record:{policies:{}},rules:{name:[{required:!0,message:this.$t("common.fillContent")}]}}},computed:{permissionCol:function(){var t=this;return[{title:"API",key:"path",minWidth:150},{title:this.$t("admin.create"),key:"POST",render:function(e,r){return t.renderAuthList({row:r.row,type:"POST"})}},{title:this.$t("admin.get"),key:"GET",render:function(e,r){return t.renderAuthList({row:r.row,type:"GET"})}},{title:this.$t("admin.update"),key:"PUT",render:function(e,r){return t.renderAuthList({row:r.row,type:"PUT"})}},{title:this.$t("admin.delete"),key:"DELETE",render:function(e,r){return t.renderAuthList({row:r.row,type:"DELETE"})}}]},isDetail:function(){return"0"!==this.id&&"create"!==this.$route.query.oper},isEdit:function(){return"0"!==this.id&&"edit"===this.$route.query.oper},operTitle:function(){return this.isEdit?this.$t("common.edit"):this.isDetail?this.$t("common.view"):this.$t("common.create")}},created:function(){this.loadPermissionList()},methods:{loadPermissionList:function(){var t=this;this.loading=!0,Object(o["b"])().then((function(e){t.loading=!1,t.permissionList=e.data,t.authTabs=t.permissionList.map((function(t){return t.name})),t.currentTab=t.authTabs[0],t.currentPermission=t.permissionList[0].content,t.record.policies=t.parsePoliciesToShow("all","never"),"0"!==t.id&&t.loadDetail()})).catch((function(){t.loading=!1}))},loadDetail:function(){var t=this;Object(s["i"])(this.id).then((function(e){var r=e.data,n=r.name,i=r.description,o=r.policies;t.$set(t.record,"name",n),t.$set(t.record,"description",i),t.setPolicies(o)})).catch((function(){}))},parsePoliciesToShow:function(t,e){var r="never",n=[],i=[],o={};return"all"===t?(this.permissionList.forEach((function(t){n.push.apply(n,a(t.content))})),r=e):(this.permissionList.filter((function(e){return e.name===t})).forEach((function(t){i.push.apply(i,a(t.content))})),this.permissionList.filter((function(e){return e.name!==t})).forEach((function(t){n.push.apply(n,a(t.content))})),i.forEach((function(t){o[t.path]={},t.methods.forEach((function(r){o[t.path][r]=e}))}))),n.forEach((function(t){o[t.path]={},t.methods.forEach((function(e){o[t.path][e]=r}))})),o},convertPolicies:function(t){var e=this,r=[];return Object.keys(t).forEach((function(n){e.allMethods.forEach((function(e){var i=t[n][e];0!==i&&1!==i||r.push({path:n,method:e,possession:i})}))})),r},findCurrentPermission:function(t){var e=this.permissionList.find((function(e){return e.name===t}));e&&(this.currentPermission=e.content)},setPolicies:function(t){var e=this;"root"!==this.record.name?t.forEach((function(t){var r=t.path,n=t.method,i=t.possession;-1!==r.indexOf("/kuiper/*")?e.record.policies=e.parsePoliciesToShow("kuiper",i):-1!==r.indexOf("/neuron/*")?e.record.policies=e.parsePoliciesToShow("neuron",i):-1!==r.indexOf("/nano/*")?e.record.policies=e.parsePoliciesToShow("nano",i):e.record.policies[r]&&(e.record.policies[r][n]=i)})):this.record.policies=this.parsePoliciesToShow("all",0)},renderAuthList:function(t){var e=this,r=t.row,n=t.type,i=this.$createElement,o=this.permissionOption.map((function(t){return i("Option",{attrs:{value:t.value}},[t.label])})),s=i("Select",{attrs:{transfer:!0,disabled:this.isDetail&&!this.isEdit},model:{value:e.record.policies[r.path][n],callback:function(t){e.$set(e.record.policies[r.path],n,t)}}},[o]);return r.methods.includes(n)?s:i("div",[this.$t("common.none")])},save:function(){var t=this;this.$refs.record.validate((function(e){if(e){var r=t.record,n=r.name,i=r.policies,o=r.description,a={name:n,description:o,policies:t.convertPolicies(i)};t.isEdit?Object(s["g"])(t.id,a).then((function(){t.$Message.success(t.$t("common.updateSuccess"))})):Object(s["a"])(a).then((function(){t.$Message.success(t.$t("common.createSuccess"))})),t.$router.push({name:"roles"})}}))}}},m=f,h=(r("06d9"),r("2877")),v=Object(h["a"])(m,n,i,!1,null,null,null);e["default"]=v.exports}}]);